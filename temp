<?php
session_start();

$auth_role = [1];
// $password = "apple";
// $password = md5($shaKey . md5($password));
// echo $password;
// 1bc42deee499c3eacd84beb569ebb9e0
// 1bc42deee499c3eacd84beb569ebb9e0 

// config
require_once('../config/require.php');

// require_once('../config/config.php');
// require_once('../config/auth.php');
// require_once('../config/database.php');
// require_once('../config/include_function.php');
// require_once('../config/admin_middleware.php');

// echo $user_id;
$title = "MMCupid::Home";
// header 
require_once('../master/cp-template-header.php');
// sidebar 
require_once('../master/cp-template-sidebar.php');
// <!-- top navigation -->
require_once('../master/cp-template-navbar.php');

$username = '';
$error = false;
$errorMessage  = '';
$processError = false;
$url = $adminBaseUrl . "show_city.php";


if (isset($_POST['submit'])) {
    $name = $mysqli->real_escape_string($_POST['name']);

    if ($name == '') {
        $error = true;
        $errorMessage .= "Fill name plz.</br>";
        $processError = true;
    }

    $checkQuery = "SELECT COUNT(*) AS count FROM `city` WHERE `name` = '$name'";
    $checkSql = $mysqli->query($checkUsernameQuery);
    $checkData = $checkUsernameSql->fetch_assoc();

    if ($checkData['count'] > 0) {
        $error = true;
        $errorMessage .= "City already exists. Please choose a different City.</br>";
        $processError = true;
    }

    if ($processError == false) {
       
        $createCitySql = "INSERT INTO `city`(`name`, `updated_by`, `created_by`) VALUES ('$name','$user_id','$user_id')";
        if ($mysqli->query($createCitySql)) {
            header("Location: $adminBaseUrl/show_city.php");
            exit();
        } else {
            $error = true;
            $errorMessage .= "Error when creating city: " . $mysqli->error . "<br>";
        }

 
    }
}

?>

<!-- page content -->
<div class="right_col" role="main">
    <div class="row shadow-sm">
        <div class="col-md-12 col-sm-12 ">
            <div class="x_panel">
                <div class="x_title">
                    <h2>Create User<small></small></h2>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <br />
                    <form action="<?php echo $adminBaseUrl ?>create_city.php" method="POST">
                        
                        <div class="item form-group">
                            <label class="col-form-label col-md-3 col-sm-3 label-align" for="name">name <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 ">
                                <input type="text" id="name" placeholder="fill name" class="form-control" name="name" value="<?php echo $name; ?>">
                            </div>
                        </div>



                        <input type="hidden" name="form-sub" value="1">
                        <div class="ln_solid"></div>
                        <div class="item form-group">
                            <div class="col-md-6 col-sm-6 offset-md-3">
                                <input type="submit" class="btn btn-primary" name="submit" value="submit"></input>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<?php
// footer 
require_once('../master/cp-template-footer.php');
// end 
if ($error == true) {
?>
    <script>
        new PNotify({
            title: 'Error',
            text: '<?php echo $errorMessage ?>',
            type: 'error',
            styling: 'bootstrap3'
        });
    </script>
<?php
}
require_once('../master/cp-template-end.php');
?>